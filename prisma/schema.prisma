generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  name      String
  role      String   // PROFESSOR or STUDENT
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  projects            Project[]            @relation("ProjectOwner")
  teamMembers         TeamMember[]
  stickyNotes         StickyNote[]
  careerAnchorResults CareerAnchorResult[] @relation("CareerAnchorResults")
}

model Project {
  id           String   @id @default(uuid())
  title        String
  description  String?
  theme        String   // STARTUP, JOB_CREATION, PROBLEM_SOLVING
  joinCode     String   @unique
  professorId  String
  professor    User     @relation("ProjectOwner", fields: [professorId], references: [id])
  currentPhase Int      @default(0)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  teams              Team[]
  templates          Template[]
  careerAnchorResults CareerAnchorResult[]
}

model Team {
  id        String   @id @default(uuid())
  name      String
  topic     String?
  projectId String
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  members     TeamMember[]
  stickyNotes StickyNote[]
}

model TeamMember {
  id       String   @id @default(uuid())
  userId   String
  teamId   String
  user     User     @relation(fields: [userId], references: [id])
  team     Team     @relation(fields: [teamId], references: [id], onDelete: Cascade)
  joinedAt DateTime @default(now())

  @@unique([userId, teamId])
}

model Template {
  id          String   @id @default(uuid())
  title       String
  description String?
  phase       Int
  theme       String?  // null means common template
  projectId   String?
  project     Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)
  isDefault   Boolean  @default(false)
  createdBy   String?
  content     String?  // JSON layout config
  createdAt   DateTime @default(now())

  stickyNotes StickyNote[]
}

model CareerAnchorResult {
  id        String   @id @default(uuid())
  userId    String
  user      User     @relation("CareerAnchorResults", fields: [userId], references: [id])
  projectId String
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  results   String   // JSON: { TF: 4.2, GM: 3.8, ... }
  topAnchor String   // e.g. "TF"
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([userId, projectId])
}

model StickyNote {
  id         String   @id @default(uuid())
  content    String
  color      String   @default("#FEF3C7")
  posX       Float
  posY       Float
  width      Float    @default(200)
  height     Float    @default(150)
  templateId String
  template   Template @relation(fields: [templateId], references: [id], onDelete: Cascade)
  teamId     String?
  team       Team?    @relation(fields: [teamId], references: [id])
  authorId   String
  author     User     @relation(fields: [authorId], references: [id])
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}
